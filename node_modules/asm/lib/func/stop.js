var asm = require('../asm');

asm.stopServer = function() {
    return new Promise(function(resolve, reject) {
       var shutdownMsg = 'tellraw @a ["",{"text":"[AnchorHosting] This server was terminated by an admin.","color":"dark_red","bold":true}]';
       asm.server.game.command(shutdownMsg);
       setTimeout(function() {
            asm.server.stop(function(err) {
                if (err) {
                    console.log("[stopServer] An error occurred while stopping the server.".red);
                    reject('Error');
                } else {
                    var stopLoop = setInterval(function() {
                        if (!asm.server.running) {
                            console.log("[stopServer] Server stopped successfully.".green);
                            resolve(null);
                            clearInterval(stopLoop);
                        }
                    }, 1000);
                }
            }); 
       }, 4000);
    });
};