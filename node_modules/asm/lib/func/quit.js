var asm = require('../asm');

asm.quit = function(force) {
    return new Promise(function(resolve, reject) {
        if (!asm.server.running) {
            console.log("[quit] Server already shut down.".green);
            console.log("[quit] Goodbye world. :(".yellow);
            process.exit(0);
            resolve(null);
        } else {
            if (!force) {
                console.log("[quit] Nicely shutting down server. :)".green);
                var shutdownMsg = 'tellraw @a ["",{"text":"[AnchorHosting] This server was terminated by an admin.","color":"dark_red","bold":true}]';
                asm.server.game.command(shutdownMsg);
                asm.stopServer().then(function(err) {
                    if (err) {
                        console.log("[quit] Uh-oh! I ran into an issue while terminating processes...".red);
                        reject('Error terminating process.');
                    } else {
                        console.log("[quit] Server *nicely* shut down. Terminating process.".green);
                        console.log("[quit] Goodbye world. :(".yellow);
                        process.exit(0);
                        resolve(null);
                    }
                });
            } else {
                console.log("[quit] Forcing server shutdown.".yellow);
                console.log("[quit] Goodbye world. :(".yellow);
                process.exit(0);
                resolve(null);
            }
        }
    });
};